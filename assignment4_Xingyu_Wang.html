<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Xingyu Wang">

<title>Which Asian country has the most expensive diet over time? Is it increasingly worth what they eat?– A seven-country comparative analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="assignment4_Xingyu_Wang_files/libs/clipboard/clipboard.min.js"></script>
<script src="assignment4_Xingyu_Wang_files/libs/quarto-html/quarto.js"></script>
<script src="assignment4_Xingyu_Wang_files/libs/quarto-html/popper.min.js"></script>
<script src="assignment4_Xingyu_Wang_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="assignment4_Xingyu_Wang_files/libs/quarto-html/anchor.min.js"></script>
<link href="assignment4_Xingyu_Wang_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="assignment4_Xingyu_Wang_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="assignment4_Xingyu_Wang_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="assignment4_Xingyu_Wang_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="assignment4_Xingyu_Wang_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="assignment4_Xingyu_Wang_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="assignment4_Xingyu_Wang_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Which Asian country has the most expensive diet over time? Is it increasingly worth what they eat?– A seven-country comparative analysis</h1>
<p class="subtitle lead">Assignment 4 ETC5512</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Xingyu Wang </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Data and Documenting</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Blog Post</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Behind the Scenes</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<section id="question-to-answer" class="level3">
<h3 class="anchored" data-anchor-id="question-to-answer">Question to answer</h3>
<p>As an international student abroad who cooks but can never quite recreate the flavors of home, I often find myself missing my mom’s cooking. Living far from home, I began to wonder: do people around the world really get what they pay for when it comes to food? That question inspired my research: Which of seven Asian countries has the most expensive diet—and is it increasingly worth what they eat?</p>
</section>
<section id="datasets-i-chose-and-why" class="level3">
<h3 class="anchored" data-anchor-id="datasets-i-chose-and-why">Datasets I chose and why</h3>
<p>To answer my question, I use data mainly from the <strong>FAO and United Nations</strong>, as these international organizations provide reliable and standardized national-level indicators, essential for cross-country comparisons.</p>
<p>I focus on <strong>four key variables</strong>:</p>
<ul>
<li><p>Consumer Food Price Index (2015 = 100) – measures how expensive food is over time in each country.</p></li>
<li><p>Prevalence of undernourishment (%)</p></li>
<li><p>Per capita food supply variability (kcal/cap/day)</p></li>
<li><p>Average dietary energy requirement (kcal/cap/day)</p></li>
</ul>
<p>The last three capture different aspects of food adequacy and stability, allowing me to assess whether expensive diets are actually “worth it.”</p>
<p>Together, these indicators offer a multidimensional view: not only how much people pay for food, but whether they get enough of it, consistently, and in line with their nutritional needs.</p>
</section>
<section id="steps-to-download-the-data" class="level3">
<h3 class="anchored" data-anchor-id="steps-to-download-the-data">Steps to download the data</h3>
<ol type="1">
<li>Food quality data</li>
</ol>
<ul>
<li>Navigate to this <a href="https://www.fao.org/faostat/en/#data/FS">FAO database page</a> about Food Security.</li>
<li>Apply filters for countries: “China”, “India”, “Indonesia”, “Japan”, “Jordan”, “Republic of Korea” and “Singapore”; elements: Value; items: “Prevalence of undernourishment (percent) (3-year average)”, “Per capita food supply variability (kcal/cap/day)” and “Average dietary energy requirement (kcal/cap/day)”; years: Select All;</li>
<li>Click “View” to display the data, then select “Download” to save it in CSV format.</li>
</ul>
<ol start="2" type="1">
<li>Food price data</li>
</ol>
<ul>
<li>Navigate to this <a href="https://www.fao.org/faostat/en/#data/CP">FAO database page</a> about Food Price.</li>
<li>Apply filters for countries: “China”, “India”, “Indonesia”, “Japan”, “Jordan”, “Republic of Korea” and “Singapore”; years: Select All; items: Consumer Price, Food Indices(2015 = 100); month: Select All</li>
<li>Click “View” to display the data, then select “Download” to save it in CSV format.</li>
</ul>
<ol start="3" type="1">
<li><p>Food price data for China This data is missing from the FAO database. To obtain it, I manually collected the data by consulting the <a href="https://www.stats.gov.cn/english/Statisticaldata/yearbook/">China Statistical Yearbook</a> from 2001 to 2024. I had hoped to use web scraping techniques to improve efficiency, but unfortunately, the yearbook does not have an online version with a structured webpage. Instead, the data is presented as images, making manual lookup the only feasible way to gather this important data.</p></li>
<li><p>Classification data of developing and developed countries Use this <a href="https://unstats.un.org/unsd/methodology/m49/historical-classification-of-developed-and-developing-regions.xlsx">URL</a>.</p></li>
</ol>
</section>
<section id="term-of-use" class="level3">
<h3 class="anchored" data-anchor-id="term-of-use">Term of Use</h3>
<ul>
<li><p>The data downloaded from FAO and UN for this assignment (Datasets 1, 2, and 4) are all available under <a href="https://creativecommons.org/licenses/by/4.0/">the Creative Commons Attribution 4.0 International (CC BY 4.0) license</a>, which permits users to: ○ Share, adapt, and use the data for any purpose including commercial use as long as proper attribution is made.</p></li>
<li><p>The food price data for China sourced from existing literature has been properly attributed through citations to their respective editions of the China Statistical Yearbook in the reference list.</p></li>
</ul>
</section>
<section id="data-processing" class="level3">
<h3 class="anchored" data-anchor-id="data-processing">Data processing</h3>
<p>load the library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rd_fq <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/FAOSTAT_data_en_6-14-2025.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rd_fp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/FAOSTAT_data_en_price_6-14-2025.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>rd_fp_china <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/china_food_cpi.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>his_classif_of_regions <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/historical-classification-of-developed-and-developing-regions.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Keep only relevant variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove columns with identical values</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>de_fp <span class="ot">&lt;-</span> rd_fp <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Domain Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Domain</span><span class="st">`</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Element Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Element</span><span class="st">`</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Item Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Year Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Note</span><span class="st">`</span>))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>de_fq <span class="ot">&lt;-</span> rd_fq <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Domain Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Domain</span><span class="st">`</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Element Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Element</span><span class="st">`</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">Item Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Year Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Note</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">str_sub</span>(Year, <span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span>       <span class="co">#S tandardize the format of the year column</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value =</span> <span class="fu">ifelse</span>(Value <span class="sc">==</span> <span class="st">"&lt;2.5"</span>, <span class="fl">2.4</span>, Value))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>his_classif_of_regions <span class="ot">&lt;-</span> his_classif_of_regions <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>( <span class="st">"ISO-alpha3 Code"</span>, <span class="st">"Developed / Developing regions"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"area_code_iso3"</span> <span class="ot">=</span> <span class="st">"ISO-alpha3 Code"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">"classification"</span> <span class="ot">=</span> <span class="st">"Developed / Developing regions"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Update China's country code to align with FAO conventions</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_code_iso3 =</span> <span class="fu">ifelse</span>(area_code_iso3 <span class="sc">==</span> <span class="st">"CHN"</span>, <span class="st">"F351"</span>, area_code_iso3))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Process food price data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>de_fp<span class="sc">$</span>Unit <span class="ot">&lt;-</span> <span class="fu">as.character</span>(de_fp<span class="sc">$</span>Unit)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sup_fp <span class="ot">&lt;-</span> de_fp <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Fill in missing 'Unit' values with "Laspeyres Index"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># (commonly used for food price indices; dimensionless, unit-free)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">Unit =</span> <span class="st">"laspeyres_index"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># Calculate the arithmetic mean of food price indices by country and year</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Unit <span class="sc">==</span> <span class="st">"laspeyres_index"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Area Code (ISO3)</span><span class="st">`</span>, Year) <span class="sc">%&gt;%</span>       </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">con_p_food_indices_year =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Handle missing values: Adjust China’s data so that the base year is 2015.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rd_fp_china_2015 <span class="ot">&lt;-</span> rd_fp_china <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to numeric in case the column is character type</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cpi_food_numeric =</span> <span class="fu">as.numeric</span>(cpi_food_based_previous_year)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a new column: CPI with base year = 2015</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">con_p_food_indices_year =</span> {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      base_index <span class="ot">&lt;-</span> <span class="fu">which</span>(year <span class="sc">==</span> <span class="dv">2015</span>)   <span class="co"># Find the position of the base year (2015)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      index_vals <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">n</span>())          <span class="co"># Create a vector to store the new index values</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      index_vals[base_index] <span class="ot">&lt;-</span> <span class="dv">100</span>       <span class="co"># Set 2015 as 100</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backward calculation (2000–2014)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (base_index <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> (base_index <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>          index_vals[i] <span class="ot">&lt;-</span> index_vals[i <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> (cpi_food_numeric[i <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">/</span> <span class="dv">100</span>)}}</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Forward calculation (2016–)</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (base_index <span class="sc">&lt;</span> <span class="fu">n</span>()) {</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> (base_index <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">n</span>()) {</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>          index_vals[i] <span class="ot">&lt;-</span> index_vals[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (cpi_food_numeric[i] <span class="sc">/</span> <span class="dv">100</span>)}}</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      index_vals})                        <span class="co"># Return the full vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Clean variable names and convert data types as needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>de_fq_cleaned <span class="ot">&lt;-</span> de_fq <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(year, value), as.numeric))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>sup_fp_cleaned <span class="ot">&lt;-</span> sup_fp <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>rd_fp_china_cleaned <span class="ot">&lt;-</span> rd_fp_china_2015 <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"cpi_food_numeric"</span>, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"cpi_food_based_previous_year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Merge datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>comp_fp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sup_fp_cleaned, rd_fp_china_cleaned)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> de_fq_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(comp_fp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"area_code_iso3"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(flag_description)) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">food_price =</span> con_p_food_indices_year) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(his_classif_of_regions, <span class="at">by =</span> <span class="st">"area_code_iso3"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>classification <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>classification)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Export the processed dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(data, <span class="st">"data/processed_food_data_35215397.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="more-details-about-my-dataset" class="level3">
<h3 class="anchored" data-anchor-id="more-details-about-my-dataset">More details about my dataset</h3>
<p>For more details like data limitations, data privacy please reference to readme and the data dictionary. They are also available from my <a href="https://github.com/Acrea-QwQ/5512_Assignment_4_XyW.git">github repository</a> for this assignment.</p>
<!-- Task 2 Tab: Writing your blogpost -->
</section>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><strong>Which Asian country has the most expensive diet over time? Is it increasingly worth what they eat?– A seven-country comparative analysis</strong></p>
<section id="motivation" class="level3">
<h3 class="anchored" data-anchor-id="motivation">Motivation</h3>
<p>As an international student abroad who cooks but can never quite recreate the flavors of home, I often find myself missing my mom’s cooking. Living far from home, I began to wonder: do people around the world really get what they pay for when it comes to food? That question inspired my research: Which of seven Asian countries has the most expensive diet—and is it increasingly worth what they eat?</p>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Below, let’s use two tables to gain an overview of the dataset’s structure and characteristics.</p>
<div class="cell" data-wanring="false">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Five-number Summary and Average Food Price by Country and Item</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">area</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">item</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">n_years</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">min</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">q1</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">median</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">q3</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">max</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">avg_food_price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">China</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Average dietary energy requirement (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2419</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2437.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2446.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2453.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2457</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">84.63</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style="     line-height: 2;">China</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Per capita food supply variability (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">11</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">15.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">21</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">25</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">29</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">84.63</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">China</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Prevalence of undernourishment (percent) (3-year average)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">22</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">5.85</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">10.1</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">80.74</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style="     line-height: 2;">India</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Average dietary energy requirement (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2216</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2257</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2285.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2313</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2336</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">80.85</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">India</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Per capita food supply variability (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">10</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">17.75</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">22</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">42</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">53</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">80.85</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style="     line-height: 2;">India</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Prevalence of undernourishment (percent) (3-year average)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">22</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">10.3</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">12.67</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">14.15</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">17.92</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">22</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">75.44</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">Indonesia</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Average dietary energy requirement (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2268</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2285.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2294</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2303.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2319</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">78.11</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style="     line-height: 2;">Indonesia</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Per capita food supply variability (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">9</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">12</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">19</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">29.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">47</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">78.11</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">Indonesia</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Prevalence of undernourishment (percent) (3-year average)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">22</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">5.9</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">6.9</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">10.55</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">17.9</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">18.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">72.93</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style="     line-height: 2;">Japan</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Average dietary energy requirement (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2418</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2419</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2423.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2432.25</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2441</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">97.27</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">Japan</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Per capita food supply variability (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">8</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">14</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">29.75</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">47</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">97.27</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style="     line-height: 2;">Japan</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Prevalence of undernourishment (percent) (3-year average)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">22</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.6</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.88</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">3.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">95.6</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">Jordan</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Average dietary energy requirement (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2254</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2289.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2309.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2340.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2371</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">82.97</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style="     line-height: 2;">Jordan</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Per capita food supply variability (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">13</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">28</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">37</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">58</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">88</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">82.97</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">Jordan</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Prevalence of undernourishment (percent) (3-year average)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">22</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">5.2</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">6.12</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">6.45</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">9.05</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">17.9</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">80.91</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style="     line-height: 2;">Republic of Korea</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Average dietary energy requirement (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2414</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2440.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2463.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2469</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2469</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">90.25</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">Republic of Korea</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Per capita food supply variability (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">10</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">20.75</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">40.5</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">42.25</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">53</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">90.25</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span style="     line-height: 2;">Republic of Korea</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Prevalence of undernourishment (percent) (3-year average)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">22</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.4</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2.6</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">86.56</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span style="     line-height: 2;">Singapore</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">Average dietary energy requirement (kcal/cap/day)</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">24</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2445</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2471.25</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2487</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2502</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">2506</span></td>
<td style="text-align: left;"><span style="     line-height: 2;">91.73</span></td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell" data-wanring="false">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Summary of Missing Values by Country and Item</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Country</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Item</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Singapore</td>
<td style="text-align: left;">Prevalence of undernourishment (percent) (3-year average)</td>
<td style="text-align: right;">22</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>From the tables we can see that food price indices mostly range between 30 and 70, while median dietary energy requirements remain around 2400 kcal. Singapore has missing values in certain years, which should be noted during analysis.</p>
</section>
<section id="analysis" class="level3">
<h3 class="anchored" data-anchor-id="analysis">Analysis</h3>
<p>Here, I will use data visualization to illustrate the trends of food prices and food quality over time, followed by an interpretation of the figures.</p>
<section id="food-price" class="level4">
<h4 class="anchored" data-anchor-id="food-price">1. Food Price</h4>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="assignment4_Xingyu_Wang_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The food price index from 2000 to 2023 reveals two distinct phases when using 2015 as a reference point. Before 2015, most Asian countries experienced a steady rise in food prices, gradually converging toward the 2015 baseline. After 2015, the trend becomes more scattered—some countries like India and Indonesia experienced rapid increases, while others like Japan and Singapore remained relatively stable.Notably, Jordan showed a rare decline in food prices around 2015–2017, diverging from the general upward trend.</p>
<p>I also find a interesting insight which treating 2015 as a pivot: before 2015, “100” represented a target level being approached; after 2015, it became a benchmark some countries exceeded significantly. This dual perspective highlights not only who pays more for food, but also when and how that burden increased. It adds temporal depth to the question of affordability and reveals that rising prices are not uniformly distributed nor equally justified across countries.</p>
</section>
<section id="food-quality" class="level4">
<h4 class="anchored" data-anchor-id="food-quality">2. Food Quality</h4>
<p>2.1 Per capita food supply variability (kcal/cap/day)</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="assignment4_Xingyu_Wang_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the earlier years, especially before 2007, two distinct trend groups are visible: Jordan, India, and South Korea show a generally higher and more fluctuating food supply variability, while China, Japan, and Indonesia remain in a lower and steadier range. After 2007, this grouping becomes less distinct, as the patterns begin to converge and fluctuate more uniformly. Indonesia’s variability shows a noticeable increase over time, with its values rising steadily in recent years. The overall trend indicates that while some countries maintain relatively stable levels, others—like Indonesia—experience growing fluctuations in food supply per capita, suggesting a loss of consistency in food availability.</p>
<p>2.2 Average dietary energy requirement (kcal/cap/day)</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="assignment4_Xingyu_Wang_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In 2000, countries fall into two distinct groups based on dietary energy requirements: a high group (above 2400 kcal) including Singapore, Korea, Japan, and China, and a low group (below 2300 kcal) including Jordan, Indonesia, and India. Over time, most countries show increasing trends, especially in the lower group. Singapore maintains the highest levels, peaking around 2540 kcal in 2010. Korea shows a similar rise-then-stabilize pattern. Japan declines steadily, while China increases overall with fluctuations around 2007 and 2017. Jordan, initially in the lower group, nearly reaches 2410 kcal by 2023, narrowing the gap significantly.</p>
<p>2.3 Prevalence of undernourishment (percent) (3-year average)</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="assignment4_Xingyu_Wang_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The chart shows three main trends in the prevalence of undernourishment across the selected Asian countries. First, an improving trend is observed in China, where the indicator consistently declines over time. India and Indonesia also initially improve, but both show a rebound around 2016, indicating some reversal. Second, a worsening trend is evident in Jordan, where undernourishment increases gradually over the years. Finally, the developed countries—Japan and South Korea—maintain consistently low levels, suggesting stable food security. These distinct patterns highlight varying nutritional challenges and progress among the countries.</p>
</section>
</section>
<section id="conclusions" class="level3">
<h3 class="anchored" data-anchor-id="conclusions">Conclusions</h3>
<section id="overall-food-quality" class="level4">
<h4 class="anchored" data-anchor-id="overall-food-quality">Overall Food Quality</h4>
<ul>
<li><p>The improvement in food quality is becoming increasingly visible in developing countries. Countries like China and Indonesia show a general upward trend in dietary energy supply, while their undernourishment rates have declined steadily. This suggests that people are not only eating more, but also gaining better access to adequate nutrition—an encouraging sign of progress toward a more “worth it” food system.</p></li>
<li><p>Rising energy demand but unstable food systems: The case of Jordan. Jordan’s dietary energy supply increased from around 2270 kcal in 2000 to over 2350 kcal in 2023 . However, it also exhibits high food price volatility, rapidly rising food prices, and a persistently high undernourishment rate. This combination highlights food system instability: while caloric intake is rising, it may not translate to nutritional adequacy or consistent access.</p></li>
<li><p>Low intake doesn’t mean undernourishment: Japan’s “less is more” approach. Japan’s dietary energy supply shows a gradual decrease from 2000 to 2023, yet its undernourishment rate remains the lowest among all countries observed, and its food price trends remain stable. This indicates a high-quality, balanced diet—fewer calories, but better nutrition.</p></li>
</ul>
</section>
<section id="discussion" class="level4">
<h4 class="anchored" data-anchor-id="discussion">Discussion</h4>
<p>🍚 Who’s paying the most for their meals? To answer this, I compared four indicators: food_price, price_volatility, calorie_supply, and undernourishment. 📊 My goal is to figure out not just who spends more, but who eats smart.</p>
<p>By 2023, Japan emerged as the most “worth it” country: stable prices, moderate and steady energy supply, and barely any undernourishment. A quiet triumph in dietary quality. 🥢 Meanwhile, China showed remarkable progress—though food is more expensive, calories are up and undernourishment is down. 📈</p>
<p>Back in 2000, both countries were mid-range, but now they’ve climbed to the top. Maybe it shows us something bigger: as economies grow, it’s not just about how much we eat, or how costly—but how well we eat. 🥦💡</p>
<p>Disclaimer: Just sharing some data-driven foodie thoughts—don’t take it too seriously, but definitely take it with a grain of salt 🧂.</p>
<p>Thank you for reading!</p>
</section>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>[© FAO] [2025] [Consumer Price Indices (FAOSTAT)] [N/A] [https://www.fao.org/faostat/en/#data/CP] [Accessed 14 June 2025]</p>
<p>[© FAO] [2025] [Food Security Indicators (FAOSTAT)] [N/A] [https://www.fao.org/faostat/en/#data/FS] [Accessed 14 June 2025]</p>
<p>United Nations Statistics Division. (n.d.). Historical classification of developed and developing regions [Data file]. United Nations. https://unstats.un.org/unsd/methodology/m49/historical-classification-of-developed-and-developing-regions.xlsx</p>
<p>National Bureau of Statistics of China. (2001). China statistical yearbook 2001 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2001c/mulu.htm</p>
<p>National Bureau of Statistics of China. (2002). China statistical yearbook 2002 [《中国统计年鉴》]. https://www.stats.gov.cn/yearbook2001/indexC.htm</p>
<p>National Bureau of Statistics of China. (2003). China statistical yearbook 2003 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/yearbook2003_c.pdf</p>
<p>National Bureau of Statistics of China. (2004). China statistical yearbook 2004 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/yb2004-c/indexch.htm</p>
<p>National Bureau of Statistics of China. (2005). China statistical yearbook 2005 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2005/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2006). China statistical yearbook 2006 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2006/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2007). China statistical yearbook 2007 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2007/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2008). China statistical yearbook 2008 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2008/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2009). China statistical yearbook 2009 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2009/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2010). China statistical yearbook 2010 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2010/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2011). China statistical yearbook 2011 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2011/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2012). China statistical yearbook 2012 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2012/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2013). China statistical yearbook 2013 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2013/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2014). China statistical yearbook 2014 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2014/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2015). China statistical yearbook 2015 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2015/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2016). China statistical yearbook 2016 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2016/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2017). China statistical yearbook 2017 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2017/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2018). China statistical yearbook 2018 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2018/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2019). China statistical yearbook 2019 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2019/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2020). China statistical yearbook 2020 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2020/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2021). China statistical yearbook 2021 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2021/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2022). China statistical yearbook 2022 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2022/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2023). China statistical yearbook 2023 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2023/indexeh.htm</p>
<p>National Bureau of Statistics of China. (2024). China statistical yearbook 2024 [《中国统计年鉴》]. https://www.stats.gov.cn/sj/ndsj/2024/indexeh.htm</p>
<p>Wickham H, Hester J, Bryan J (2024). <em>readr: Read Rectangular Text Data</em>. doi:10.32614/CRAN.package.readr <a href="https://doi.org/10.32614/CRAN.package.readr" class="uri">https://doi.org/10.32614/CRAN.package.readr</a>, R package version 2.1.5, <a href="https://CRAN.R-project.org/package=readr" class="uri">https://CRAN.R-project.org/package=readr</a>.</p>
<p>Wickham H, Bryan J (2025). <em>readxl: Read Excel Files</em>. doi:10.32614/CRAN.package.readxl <a href="https://doi.org/10.32614/CRAN.package.readxl" class="uri">https://doi.org/10.32614/CRAN.package.readxl</a>, R package version 1.4.5, <a href="https://CRAN.R-project.org/package=readxl" class="uri">https://CRAN.R-project.org/package=readxl</a>.</p>
<p>Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). “Welcome to the tidyverse.” <em>Journal of Open Source Software</em>, <em>4</em>(43), 1686. doi:10.21105/joss.01686 <a href="https://doi.org/10.21105/joss.01686" class="uri">https://doi.org/10.21105/joss.01686</a>.</p>
<p>Wickham H, Vaughan D, Girlich M (2024). <em>tidyr: Tidy Messy Data</em>. doi:10.32614/CRAN.package.tidyr <a href="https://doi.org/10.32614/CRAN.package.tidyr" class="uri">https://doi.org/10.32614/CRAN.package.tidyr</a>, R package version 1.3.1, <a href="https://CRAN.R-project.org/package=tidyr" class="uri">https://CRAN.R-project.org/package=tidyr</a>. Wickham H, François R, Henry L, Müller K, Vaughan D (2023). <em>dplyr: A Grammar of Data Manipulation</em>. doi:10.32614/CRAN.package.dplyr <a href="https://doi.org/10.32614/CRAN.package.dplyr" class="uri">https://doi.org/10.32614/CRAN.package.dplyr</a>, R package version 1.1.4, <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a>.</p>
<p>Wickham H (2023). <em>stringr: Simple, Consistent Wrappers for Common String Operations</em>. doi:10.32614/CRAN.package.stringr <a href="https://doi.org/10.32614/CRAN.package.stringr" class="uri">https://doi.org/10.32614/CRAN.package.stringr</a>, R package version 1.5.1, <a href="https://CRAN.R-project.org/package=stringr" class="uri">https://CRAN.R-project.org/package=stringr</a>.</p>
<p>Wickham H (2023). <em>stringr: Simple, Consistent Wrappers for Common String Operations</em>. doi:10.32614/CRAN.package.stringr <a href="https://doi.org/10.32614/CRAN.package.stringr" class="uri">https://doi.org/10.32614/CRAN.package.stringr</a>, R package version 1.5.1, <a href="https://CRAN.R-project.org/package=stringr" class="uri">https://CRAN.R-project.org/package=stringr</a>. Firke S (2024). <em>janitor: Simple Tools for Examining and Cleaning Dirty Data</em>. doi:10.32614/CRAN.package.janitor <a href="https://doi.org/10.32614/CRAN.package.janitor" class="uri">https://doi.org/10.32614/CRAN.package.janitor</a>, R package version 2.2.1, <a href="https://CRAN.R-project.org/package=janitor" class="uri">https://CRAN.R-project.org/package=janitor</a>.</p>
<p>H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.</p>
<p>Xie Y (2025). <em>knitr: A General-Purpose Package for Dynamic Report Generation in R</em>. R package version 1.50, <a href="https://yihui.org/knitr/" class="uri">https://yihui.org/knitr/</a>.</p>
<p>Yihui Xie (2015) Dynamic Documents with R and knitr. 2nd edition. Chapman and Hall/CRC. ISBN 978-1498716963</p>
<p>Yihui Xie (2014) knitr: A Comprehensive Tool for Reproducible Research in R. In Victoria Stodden, Friedrich Leisch and Roger D. Peng, editors, Implementing Reproducible Computational Research. Chapman and Hall/CRC. ISBN 978-1466561595</p>
<p>Zhu H (2024). <em>kableExtra: Construct Complex Table with ‘kable’ and Pipe Syntax</em>. doi:10.32614/CRAN.package.kableExtra <a href="https://doi.org/10.32614/CRAN.package.kableExtra" class="uri">https://doi.org/10.32614/CRAN.package.kableExtra</a>, R package version 1.4.0, <a href="https://CRAN.R-project.org/package=kableExtra" class="uri">https://CRAN.R-project.org/package=kableExtra</a>.</p>
<!-- Task 3 Tab: Behind the Scenes -  -->
</section>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<section id="data-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling">Data Wrangling</h3>
<ul>
<li><p>Extracting China’s food price data took up 90% of my time—seriously. The data was only available in image format from yearbooks, making web scraping impossible. Hopefully someday we’ll have smarter tools to deal with this kind of thing.</p></li>
<li><p>Overall, data processing wasn’t too painful, thanks to the fact that the sources are major international organizations. Most datasets had already been reasonably cleaned. Plus, the use of standardized country codes (like ISO3) made joining tables more straightforward.</p></li>
</ul>
</section>
<section id="challenges-along-the-way" class="level3">
<h3 class="anchored" data-anchor-id="challenges-along-the-way">Challenges Along the Way</h3>
<ul>
<li><p>Mid-project topic switch! Initially, I planned to use countries from multiple continents, but the patterns were too chaotic. I decided to narrow it down to Asian countries only, which made the dataset more geographically coherent—and the trends easier to spot 📈.</p></li>
<li><p>Variable trouble: One of the variables I introduced later—Prevalence of undernourishment (percent)—used three-year average intervals instead of single-year values. I kept getting mysterious errors when running old code from the intercontinental version of the dataset. It took some serious digging to realize the issue was the year format 😅. Lesson learned: whenever switching variables (ideally avoid doing so mid-project), double-check their structure, even if the data looks “clean.” I’m glad I caught the issue and fixed it—definitely grew a bit as a data wrangler there.</p></li>
</ul>
</section>
<section id="limitations-future-improvements" class="level3">
<h3 class="anchored" data-anchor-id="limitations-future-improvements">Limitations &amp; Future Improvements</h3>
<ul>
<li><p>As I mentioned in the README, I should look into more robust methods for converting monthly food prices to annual values—perhaps using weighted averages instead of simple means.</p></li>
<li><p>National food price indices can be heavily skewed by income distribution. For example, very wealthy or very poor populations might distort the “average.” Addressing this properly would require country-level microdata, ideally scraped from national statistics portals and filtered for outliers.</p></li>
</ul>
</section>
<section id="history-log" class="level3">
<h3 class="anchored" data-anchor-id="history-log">History Log</h3>
<p>You can check out the version history on my <strong><a href="https://github.com/Acrea-QwQ/5512_Assignment_4_XyW.git">GitHub repository</a></strong>. I’ve marked key stages using tags, and you might find the commit messages helpful—they highlight major changes I made along the way.</p>
</section>
<section id="ai-acknowledgment" class="level3">
<h3 class="anchored" data-anchor-id="ai-acknowledgment">AI acknowledgment</h3>
<p>https://chatgpt.com/share/684ff2e0-c9cc-8009-a45e-50c07f19cdc3</p>
</section>
</div>
</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>